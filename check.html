<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç”³è«‹æ‰¿èªãƒšãƒ¼ã‚¸</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f1f8e9;
      padding: 20px;
      font-size: 18px;
    }
    .application {
      border: 1px solid #ccc;
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 8px;
      background-color: #ffffff;
    }
    .status {
      font-weight: bold;
      margin-bottom: 8px;
    }
    .actions {
      margin-top: 10px;
    }
    .actions button {
      margin-right: 10px;
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
    }
    .approved {
      color: green;
    }
    .rejected {
      color: red;
    }
    .pending {
      color: orange;
    }
    .approver-select {
      margin-top: 10px;
      margin-bottom: 10px;
      font-size: 16px;
    }
    #notification {
      display: none;
      background-color: #ffeb3b;
      color: #000;
      padding: 10px 20px;
      font-weight: bold;
      margin-bottom: 20px;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
    }
  </style>
</head>
<body>
  <h2>ç”³è«‹æ‰¿èªãƒšãƒ¼ã‚¸</h2>
 
  <!-- ğŸ”” é€šçŸ¥ãƒãƒ¼ -->
  <div id="notification">ğŸ”” æ–°ã—ã„ç”³è«‹ãŒå±Šãã¾ã—ãŸã€‚ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ›´æ–°</div>
 
  <!-- ğŸ”Š é€šçŸ¥éŸ³ -->
  <audio id="notifySound">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3" type="audio/mpeg">
  </audio>
 
  <div id="appList"></div>
 
  <script>
    const approverOptions = ["æ¦ŠåŸå‰›", "è±Šç”°ç« å¤«", "æ²³åˆæº€"];
    let lastKnownCount = (JSON.parse(localStorage.getItem("formHistory")) || []).length;
 
    function loadApplications() {
      const container = document.getElementById("appList");
      container.innerHTML = "";
 
      const history = JSON.parse(localStorage.getItem("formHistory")) || [];
 
      history.forEach((entry, index) => {
        const status = entry.status || "pending";
        const approver = entry.approver || "";
        const app = document.createElement("div");
        app.className = "application";
 
        let statusText = "";
        let statusClass = "";
 
        if (status === "approved") {
          statusText = `âœ… æ‰¿èªæ¸ˆã¿ï¼ˆ${approver}ï¼‰`;
          statusClass = "approved";
        } else if (status === "rejected") {
          statusText = `âŒ å´ä¸‹ï¼ˆ${approver}ï¼‰`;
          statusClass = "rejected";
        } else {
          statusText = "â³ æœªå‡¦ç†";
          statusClass = "pending";
        }
 
        app.innerHTML = `
          <div class="status ${statusClass}">çŠ¶æ…‹: ${statusText}</div>
          <div><strong>æ—¥æ™‚:</strong> ${entry.timestamp}</div>
          <div><strong>æœŸ:</strong> ${entry.item1}</div>
          <div><strong>å­¦å¹´:</strong> ${entry.item2}</div>
          <div><strong>ã‚¯ãƒ©ã‚¹:</strong> ${entry.item3}</div>
          <div><strong>ç•ªå·:</strong> ${entry.item4}</div>
          <div><strong>å¾“æ¥­å“¡ç•ªå·:</strong> ${entry.item5}</div>
          <div><strong>åå‰:</strong> ${entry.item6}</div>
          <div><strong>ç†ç”±:</strong> ${entry.textarea1}</div>
          <div><strong>ä»Šå¾Œã®å¯¾ç­–:</strong> ${entry.textarea2}</div>
        `;
 
        const actionDiv = document.createElement("div");
        actionDiv.className = "actions";
 
        if (status === "pending") {
          const select = document.createElement("select");
          select.className = "approver-select";
          approverOptions.forEach(name => {
            const option = document.createElement("option");
            option.value = name;
            option.textContent = name;
            select.appendChild(option);
          });
 
          const approveBtn = document.createElement("button");
          approveBtn.textContent = "æ‰¿èª";
          approveBtn.onclick = () => updateStatus(index, "approved", select.value);
 
          const rejectBtn = document.createElement("button");
          rejectBtn.textContent = "å´ä¸‹";
          rejectBtn.onclick = () => updateStatus(index, "rejected", select.value);
 
          app.appendChild(select);
          actionDiv.appendChild(approveBtn);
          actionDiv.appendChild(rejectBtn);
        } else {
          const cancelBtn = document.createElement("button");
          cancelBtn.textContent = "ã‚­ãƒ£ãƒ³ã‚»ãƒ«";
          cancelBtn.onclick = () => updateStatus(index, "pending", "");
          actionDiv.appendChild(cancelBtn);
        }
 
        app.appendChild(actionDiv);
        container.appendChild(app);
      });
    }
 
    function updateStatus(index, status, approverName) {
      const history = JSON.parse(localStorage.getItem("formHistory")) || [];
      history[index].status = status;
      history[index].approver = approverName;
      localStorage.setItem("formHistory", JSON.stringify(history));
      lastKnownCount = history.length;
      loadApplications();
    }
 
    // ğŸ”” æ–°è¦ç”³è«‹ç›£è¦–
    function checkForNewApplications() {
      const currentHistory = JSON.parse(localStorage.getItem("formHistory")) || [];
      if (currentHistory.length > lastKnownCount) {
        document.getElementById("notification").style.display = "block";
        document.getElementById("notifySound").play();
      }
    }
 
    setInterval(checkForNewApplications, 3000);
 
    document.getElementById("notification").onclick = () => {
      lastKnownCount = (JSON.parse(localStorage.getItem("formHistory")) || []).length;
      document.getElementById("notification").style.display = "none";
      loadApplications();
    };
 
    window.onload = loadApplications;
  </script>
</body>
</html>
